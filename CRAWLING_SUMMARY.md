# NOTAM 데이터 수집 완료 보고서

작성일: 2025-11-30

---

## 📊 수집 결과

### 전체 통계
- **총 NOTAM 개수**: 72,800개
- **수집 기간**: 2023-01-01 ~ 2025-11-30
- **파일 크기**: 70.61 MB (JSON)
- **데이터베이스**: `notam_realtime.db`
- **JSON 파일**: `notam_data.json`

### 연도별 상세
| 연도 | 국내 | 국제 | 합계 | 비고 |
|------|------|------|------|------|
| 2023 | 14,200 | 0 | 14,200 | 국제 데이터 API 오류 (500) |
| 2024 | 15,100 | 15,100 | 30,200 | 정상 수집 |
| 2025 | 14,200 | 14,200 | 28,400 | 정상 수집 (진행 중) |
| **합계** | **43,500** | **29,300** | **72,800** | |

---

## 🔧 해결된 주요 버그

### 1. API 필드 매핑 오류
- **문제**: API 응답 필드가 대문자(NOTAM_NO, LOCATION)인데 소문자로 파싱 시도
- **증상**: 15,300개 수집했지만 0개 저장, 모두 "NOTAM 번호 없음"으로 거부
- **해결**: `_parse_json_response()` 함수 사용하여 대문자→소문자 변환

### 2. SQLite UNIQUE 제약 조건 (가장 심각)
- **1차 시도**: `UNIQUE(notam_number)` → 14,200개 중 99개만 저장
- **2차 시도**: `UNIQUE(notam_number, a_location, b_start_time)` → 0개 저장
- **최종 해결**: UNIQUE 제약 전부 제거, `INSERT OR IGNORE` → `INSERT`로 변경
- **결과**: 72,800개 전체 저장 성공

### 3. 연도별 데이터 존재 여부
- **초기 요구사항**: 2020-01-01부터 현재까지
- **실제 API 데이터**: 2023년부터만 존재 (2020-2022 데이터 없음)
- **최종 수집**: 2023-2025 (존재하는 모든 데이터)

### 4. 페이지네이션 로직
- **문제**: 페이지 전환 시 일부 데이터 누락
- **해결**: API 응답의 "Total" 필드 사용하여 정확한 페이지 수 계산

---

## 📁 생성된 파일

### 데이터베이스 파일
```
notam_2023.db         - 2023년 데이터 (14,200개)
notam_2024.db         - 2024년 데이터 (30,200개)
notam_2025.db         - 2025년 데이터 (28,400개)
notam_realtime.db     - 병합된 전체 데이터 (72,800개)
```

### JSON 파일
```
notam_data.json       - S3 업로드용 JSON (70.61 MB, 72,800개)
```

### 크롤링 스크립트
```
notam_crawler_api.py      - 메인 크롤러 (수정됨)
crawl_year_parallel.py    - 연도별 병렬 크롤링
merge_databases.py        - DB 병합 스크립트
```

### S3 업로드 스크립트
```
upload_to_s3.py           - 단일 버킷 업로드 (기존)
upload_to_both_buckets.py - 양쪽 버킷 업로드 (신규)
setup_aws_credentials.py  - AWS 인증 정보 설정 도우미
quick_upload.bat          - 빠른 업로드 배치 파일
UPLOAD_README.md          - S3 업로드 가이드
```

### 로그 파일
```
crawl_2023.log        - 2023년 크롤링 로그
crawl_2024.log        - 2024년 크롤링 로그
crawl_2025.log        - 2025년 크롤링 로그
upload_main.log       - S3 업로드 시도 로그
```

---

## ⏳ 크롤링 성능

- **병렬 처리**: 3개 프로세스 동시 실행 (2023, 2024, 2025)
- **총 소요 시간**: 약 10-15분 (연도별 병렬 처리)
- **단일 실행 예상 시간**: 30-45분

---

## ⚠️ 알려진 이슈

### 1. 2023년 국제 NOTAM 누락
- **상태**: API 500 에러로 수집 실패
- **영향**: 2023년은 국내 NOTAM만 포함
- **해결 방안**: API 복구 후 재수집 필요

### 2. 2020-2022년 데이터 없음
- **상태**: API에 해당 기간 데이터 존재하지 않음
- **영향**: 사용자가 원한 2020-01-01부터의 전체 데이터 수집 불가
- **대안**: 2023년부터 시작하는 72,800개 데이터 제공

---

## ✅ 다음 단계: S3 업로드

### 현재 상태
- ❌ AWS 인증 정보 미설정
- ✅ 업로드할 JSON 파일 준비 완료 (70.61 MB)
- ✅ 업로드 스크립트 준비 완료

### 업로드 방법 (3가지 중 선택)

#### 방법 1: AWS CLI 사용 (권장)
```bash
aws configure  # 인증 정보 입력
py upload_to_both_buckets.py
```

#### 방법 2: Python 스크립트 사용
```bash
py setup_aws_credentials.py  # 대화형 인증 정보 설정
py upload_to_both_buckets.py
```

#### 방법 3: 배치 파일 사용 (Windows)
```bash
# quick_upload.bat 편집하여 키 입력 후
quick_upload.bat
```

### 업로드 대상
1. `notam-korea-data` (메인)
2. `notam-backup` (백업)

---

## 📋 데이터 스키마

```json
{
  "id": 1,
  "notam_number": "A0123/25",
  "a_location": "RKSI",
  "b_start_time": "2512010000",
  "c_end_time": "2512312359",
  "d_schedule": "",
  "e_text": "RWY 15R/33L CLSD",
  "f_lower_limit": "000",
  "g_upper_limit": "999",
  "collected_at": "2025-11-30 21:00:00",
  "last_updated": "2025-11-30 21:00:00",
  "q_code": "QMRLC",
  "series_type": "A",
  "full_text": "...",
  "status": "ACTIVE",
  "crawl_timestamp": "2025-11-30 21:00:00"
}
```

---

## 🎯 최종 체크리스트

- ✅ 2023-2025년 모든 NOTAM 수집 완료
- ✅ 데이터베이스 병합 완료 (72,800개)
- ✅ JSON 파일 생성 완료 (70.61 MB)
- ✅ S3 업로드 스크립트 준비 완료
- ❌ AWS 인증 정보 설정 필요
- ❌ S3 업로드 실행 필요

---

## 📞 문의사항

- 2023년 국제 NOTAM 재수집 필요 시 알려주세요
- 추가 연도 데이터가 필요하면 크롤링 범위 조정 가능
- S3 업로드 시 문제 발생 시 로그 파일 확인
